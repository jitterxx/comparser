<%inherit file="control_center_base.html"/>

<%block name="title">
  <title>Панель управления - Настройки</title>
</%block>


<%block name="navigation">
<div id="navbar" class="navbar-collapse collapse">
    <ul class="nav navbar-nav navbar-right navbar-style">
        <li><a href="/control_center">На главную</a></li>
    </ul>
</div>
</%block>

<%block name="base">

<div class="row">
    <div class="col-sm-12 col-md-12" align="left">
        <div align="left">
            <h2>Управление пользователями</h2>
            <p class="text-muted">Добавление, редактирование, отключение пользователей.</p>
            <div style="margin-bottom: 1em;">
                <a href="new_user">
                    <i class="fa fa-plus-circle fa-2x"></i>
                </a>
            </div>
            <table class="table table-condensed table-hover" border="0">
            %for one in users:
                %if one.uuid == session_context.get("user").uuid:
                <tr align="center" class="text-muted">
                %else:
                <tr align="center">
                %endif
                    <td width="20%">${one.name} ${one.surname}</td>
                    <td width="10%">${one.login}</td>
                    <td width="10%">${one.email}</td>
                    <td width="5%">${user_status[one.disabled]}</td>
                    <td width="10%">
                    %if one.uuid != session_context.get("user").uuid:
                        <a href="edit_user?user_uuid=${one.uuid}">
                            <i class="fa fa-pencil"></i>
                        </a>
                        %if one.disabled:
                        <a href="change_user_status?user_uuid=${one.uuid}">
                            <i class="fa fa-check-circle-o text-success"></i>
                        </a>
                        %else:
                        <a href="change_user_status?user_uuid=${one.uuid}">
                            <i class="fa fa-ban text-danger"></i>
                        </a>
                        %endif
                    %endif
                    </td>
                    <td></td>

                </tr>

            %endfor

            </table>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-12 col-md-12" align="left">
        <h2>Управление уведомлениями</h2>
        <p>
            Назначение пользователей на получение уведомлений от системы. <br>
            Пользователь будет получать уведомления, если в полях От, Кому, Копия будут обнаружены адреса входящие
            в его список наблюдения.<br>
            Адрес может быть указан полностью или только домен (часть после @).<br>
        </p>
        <%
            users_dict = dict()
            for one in users:
                users_dict[one.uuid] = one
        %>
        <div style="margin-bottom: 1em;">
            <a href="new_watch_rec?from_url=/control_center/settings/administration">
                <i class="fa fa-plus-circle fa-2x"></i>
            </a>
        </div>
        <table class="table tabel-condensed table-hover" border=0 width="50%">
            %for i in range(0, len(watch_list.keys())):
            <%
                one = watch_list.keys()[i]
            %>
            <tr align="left">
                <td width="10%">${one}</td>

                <td width="50%">
                    %for uuid in watch_list.get(one):
                    <span class="btn btn-default">
                        ${users_dict.get(uuid).name} ${users_dict.get(uuid).surname}
                        <a href="delete_watch_rec?user_uuid=${uuid}&client_marker=${one}&from_url=/control_center/settings/administration">
                            <i class="fa fa-times"></i>
                        </a>

                    </span>

                    %endfor
                    <a data-toggle="collapse" href="#collapse_${i}"
                       aria-expanded="false" aria-controls="collapse_${i}">
                        <i class="fa fa-plus"></i>
                    </a>
                </td>
                <td width="20%">
                    <div class="collapse" id="collapse_${i}">
                        <div class="well">
                            %for user in users:
                            %if user.uuid not in watch_list.get(one):
                            <a role="button" class="btn btn-default"
                               href="add_watch_rec?user_uuid=${user.uuid}&client_marker=${one}&from_url=/control_center/settings/administration">
                                ${user.name} ${user.surname}
                            </a>
                            %endif
                            %endfor
                        </div>
                    </div>
                </td>
                <td></td>
            </tr>
            %endfor
        </table>

    </div>
</div>

<div class="row">
    <div class="col-sm-12 col-md-12" align="left">
        <h2>Управление исключениями</h2>
        <p>
            Сообщения у которых указанные адреса встретятся в полях От, Кому, Копия не будут обрабатываться.
        </p>
    </div>
</div>
</%block>




<%block name="footer"/>
